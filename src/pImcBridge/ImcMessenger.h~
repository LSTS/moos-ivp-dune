/*
 * ImcMessenger.h
 *
 *  Created on: 30 September 2013
 *      Author: zp
 */

#ifndef IMCMESSENGER_H_
#define IMCMESSENGER_H_

# include <DUNE/DUNE.hpp>

# include <boost/thread/thread.hpp>

# include "EuropaExtensions.hh"

using DUNE_NAMESPACES;
using namespace TREX::transaction;
using namespace TREX::utils;

typedef struct {
  Message * msg;
  int port;
  std::string addr;
} SendRequest;

    class ImcMessenger
    {
    public:
      ImcMessenger();

      void startListening(int bindPort);
      void stopListening();
      bool inboxEmpty();
      Message * receive();
      void post(Message * msg, int port, std::string addr);

      virtual
      ~ImcMessenger();

    private:
      boost::thread * receiver, * sender;
      std::queue<Message *> inbox;
      std::queue<SendRequest> outbox;
      Concurrency::Mutex send_mutex, receive_mutex;
    };
  


#endif /* IMCMESSENGER_H_ */

